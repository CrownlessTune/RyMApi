import{r as t,b as D,j as s,a as A,P as w,g as M,c as q,d as m,s as z,e as N,f as G,h as H,u as L}from"./index-D2HsFtFe.js";const J=()=>{const[b,U]=t.useState([]),[l,u]=t.useState([]),[h,v]=t.useState({}),[R,y]=t.useState(!0),[g,f]=t.useState(null),[I,x]=t.useState(!1),[d,j]=t.useState(1),p=5,o=D.currentUser?D.currentUser.uid:null,E=async()=>{try{y(!0);const e=await A.get("https://rickandmortyapi.com/api/character");U(e.data.results)}catch(e){console.error("Error fetching characters:",e),f("Error fetching characters")}finally{y(!1)}},C=e=>{if(h[e.id])return h[e.id];const a=new Image;return a.onload=()=>{v(n=>({...n,[e.id]:e.image})),localStorage.setItem(e.id,e.image)},a.onerror=()=>{v(n=>({...n,[e.id]:w})),localStorage.setItem(e.id,w)},a.src=e.image,e.image},k=async()=>{if(o)try{const e=await M(q(m,"favorites",o,"items")),a=[];e.forEach(n=>a.push({id:n.id,...n.data()})),u(a)}catch(e){console.error("Error fetching favorites:",e),f("Error fetching favorites")}},P=async e=>{if(o)try{await z(N(m,"favorites",o,"items",e.id.toString()),e),u(a=>[...a,e])}catch(a){console.error("Error saving favorite:",a),f("Error saving favorite")}},r=async e=>{if(o)try{await G(N(m,"favorites",o,"items",e.id.toString())),u(a=>a.filter(n=>n.id!==e.id))}catch(a){console.error("Error removing favorite:",a),f("Error removing favorite")}},c=e=>{l.some(n=>n.id===e.id)?r(e):P(e)};t.useEffect(()=>{o&&(E(),k())},[o]);const i=d*p,F=i-p,S=b.slice(F,i),B=d===1,O=d*p>=b.length;return s.jsxs("div",{className:"api-pagination",children:[s.jsxs("div",{className:"favorites-list",children:[s.jsx("h2",{children:"Favorites"}),l.map(e=>s.jsxs("div",{className:"favorite-card",children:[s.jsx("img",{src:C(e),alt:e.name,className:"favorite-image"}),s.jsx("p",{children:e.name})]},e.id))]}),s.jsx("button",{onClick:()=>x(!0),className:"edit-favorites-btn",children:"Edit Favorites"}),I&&s.jsx("div",{className:"modal",children:s.jsxs("div",{className:"modal-content",children:[s.jsx("h2",{children:"Characters"}),s.jsx("div",{className:"item-list",children:S.map(e=>s.jsxs("div",{className:"card",children:[s.jsx("img",{src:C(e),alt:e.name,className:"card-image"}),s.jsx("h3",{className:"card-title",children:e.name}),s.jsx("button",{onClick:()=>c(e),className:"add-to-fav-btn",children:l.some(a=>a.id===e.id)?"Remove from Fav":"Add to Fav"})]},e.id))}),s.jsxs("div",{className:"pagination",children:[s.jsx("button",{onClick:()=>j(e=>e-1),disabled:B,children:"Previous"}),s.jsxs("span",{children:["Page ",d]}),s.jsx("button",{onClick:()=>j(e=>e+1),disabled:O,children:"Next"})]}),s.jsx("button",{onClick:()=>x(!1),className:"close-modal-btn",children:"Close"})]})})]})},Q=()=>{const[b,U]=t.useState(()=>{const r=localStorage.getItem("profileImage");return r||w}),[l,u]=t.useState(""),[h,v]=t.useState(""),[R,y]=t.useState(""),[g,f]=t.useState(""),[I,x]=t.useState(!1),[d,j]=t.useState(!1),[p,o]=t.useState(!0),E=t.useRef(null);t.useEffect(()=>{(async()=>{o(!0);const c=D.currentUser;if(!c){console.warn("No authenticated user found"),o(!1);return}try{const i=N(m,"users",c.uid),F=await H(i);if(!F.exists()){console.warn("User document does not exist in Firestore"),o(!1);return}const S=F.data();y(S.username||"Anonymous"),u(S.bio||""),v(S.slogan||""),f(c.uid)}catch(i){console.error("Error fetching user data:",i)}finally{o(!1)}})()},[]);const C=r=>{const c=r.target.files[0];if(!c){console.error("No file selected");return}const i=URL.createObjectURL(c);localStorage.setItem("profileImage",i),U(i)},k=()=>{if(g){const r=N(m,"users",g);L(r,{bio:l})}x(!1)},P=()=>{if(g){const r=N(m,"users",g);L(r,{slogan:h})}j(!1)};return p?s.jsx("div",{children:"Loading..."}):s.jsxs("div",{className:"user-profile-container",children:[s.jsxs("div",{className:"profile-header",children:[s.jsx("img",{className:"profile-image",src:b,alt:"Profile",onClick:()=>E.current.click()}),s.jsx("input",{type:"file",ref:E,style:{display:"none"},accept:"image/*",onChange:C})]}),s.jsx("h2",{children:R}),s.jsxs("p",{children:["ID: ",g]}),s.jsxs("div",{onClick:()=>x(!0),children:[s.jsx("div",{className:"section-title",children:"Bio:"}),I?s.jsxs("div",{children:[s.jsx("textarea",{className:"editable-textarea",value:l,onChange:r=>u(r.target.value),placeholder:"Enter your bio",style:{height:I?"auto":"30px"}}),s.jsx("button",{className:"save-button",onClick:k,children:"Save Bio"})]}):s.jsx("p",{children:l||"Click here to add your bio"})]}),s.jsxs("div",{onClick:()=>j(!0),children:[s.jsx("div",{className:"section-title",children:"Slogan:"}),d?s.jsxs("div",{children:[s.jsx("input",{className:"editable-input",type:"text",value:h,onChange:r=>v(r.target.value),placeholder:"Enter your slogan",style:{width:d?"auto":"100%"}}),s.jsx("button",{className:"save-button",onClick:P,children:"Save Slogan"})]}):s.jsx("p",{children:h||"Click here to add your slogan"})]}),s.jsx(J,{})]})};export{Q as default};
